fmApp.controller("MapManager",["$scope","$timeout",function($scope,$timeout){var changeMapState,changePlanOnMap,getFriendOffset,getOffset,positionMapRelativeToFriend,resetActivePoint,setDrawerProperties,setNewPoint,showTimeSelector,toggleMapDrawer;$scope.mapState="friends";$scope.activeMapPoint=null;$scope.drawerIsOpen=false;$scope.drawerState="mini";$scope.activeFooterView=null;$scope.leftBeaconPosition=48;$scope.topBeaconPosition=44;$scope.mapLeftOffset=0;$scope.mapTopOffset=0;$scope.places=[{name:"Roots Stage",pos_left:"38",pos_top:"30",type:"stage",isActive:false},{name:"Riot Stage",pos_left:"68",pos_top:"60",type:"stage",isActive:false},{name:"Cheesies",pos_left:"58",pos_top:"52",type:"refreshments",isActive:false},{name:"Beer Tent",pos_left:"32",pos_top:"35",type:"beer",isActive:false},{name:"Emergency Services",pos_left:"30",pos_top:"62",type:"first_aid",isActive:false}];$scope.changeMapState=function(state){toggleMapDrawer(false);return $scope.mapState=state};$scope.triggerMapPoint=function(point,viewType){var activating;activating=!point.isActive;if($scope.activeMapPoint){resetActivePoint()}if(activating){return setNewPoint(point,viewType)}};$scope.checkForDrawerClose=function($event){var matchers,selector;if(!$scope.drawerIsOpen){return}selector=jQuery($event.target);matchers=[".map-footer","[data-map-point]"];if($scope.utils.selectedIsNotThese(selector,matchers)){return resetActivePoint()}};$scope.$watch("plan.currentPlan",function(){return changePlanOnMap()});changePlanOnMap=function(){var settingTime;settingTime=$scope.plan.currentPlan==="setting-time";if(settingTime){return showTimeSelector()}else{return changeMapState()}};changeMapState=function(){toggleMapDrawer(false);return positionMapRelativeToFriend()};positionMapRelativeToFriend=function(){$scope.mapLeftOffset=getFriendOffset("left");return $scope.mapTopOffset=getFriendOffset("top")};getFriendOffset=function(position){if($scope.plan.friendYoureMeeting){return getOffset(position)}else{return 0}};getOffset=function(position){var friendPosition,scale,yourPosition;scale=1.4;yourPosition=$scope[position+"BeaconPosition"];friendPosition=$scope.plan.friendYoureMeeting["map_pos_"+position];return parseInt(yourPosition*scale-friendPosition*scale)};resetActivePoint=function(){$scope.activeMapPoint.isActive=false;$scope.activeMapPoint=null;return toggleMapDrawer(false)};setNewPoint=function(point,viewType){point.isActive=true;$scope.activeMapPoint=point;return toggleMapDrawer(true,viewType)};showTimeSelector=function(){$scope.drawerState="half-screen";return toggleMapDrawer(true,"settingTime","half-screen")};toggleMapDrawer=function(isOpen,viewType,displayType){$scope.drawerIsOpen=isOpen;if(isOpen){return setDrawerProperties(viewType,displayType)}};return setDrawerProperties=function(viewType,displayType){$scope.drawerState=displayType||"mini";return $scope.activeFooterView=viewType}}]);
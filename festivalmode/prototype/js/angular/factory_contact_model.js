fmApp.factory("ContactItem",["$rootScope","$timeout",function($rootScope,$timeout){var ContactItem;return ContactItem=function(){function ContactItem(staticModel,collection){$.extend(true,this,staticModel);this.collection=collection;this.firstName=this.name.split(" ")[0]}ContactItem.prototype.isFriend=function(){return this.relationship==="friend"};ContactItem.prototype.isNearby=function(){return this.canSeeYou()&&this.idle&&this.idle<15};ContactItem.prototype.canSeeYou=function(){return this.isFriend()&&this.hasPermissionToSeeYou};ContactItem.prototype.isFriendButCantSeeYou=function(){return this.isFriend()&&!this.hasPermissionToSeeYou};ContactItem.prototype.setAsFriend=function(){this.setRelationshipAs("friend");return this.allowVisibility(true)};ContactItem.prototype.unfriend=function(){return this.setRelationshipAs("contact")};ContactItem.prototype.invite=function(){this.setRelationshipAs("invited");return $timeout(function(_this){return function(){return _this.setAsFriend()}}(this),3e3)};ContactItem.prototype.setRelationshipAs=function(relationship){this.relationship=relationship;return this.collection.updateFriendCounts()};ContactItem.prototype.allowVisibility=function(state){return this.hasPermissionToSeeYou=state};ContactItem.prototype.idleMessage=function(){var isIdle;isIdle=this.isNearby()&&this.idle>10;if(isIdle){return", idle "+this.idle+"m"}else{return""}};ContactItem.prototype.isMoving=function(){if(!(this.isNearby()&&this.plans)){return false}return this.plans!=="posting_up"};ContactItem.prototype.isPostingUp=function(){return this.plans&&this.plans==="posting_up"};ContactItem.prototype.messagePlacement=function(){var offset;offset=this.map_pos_left||0;if(offset>50){return"left-side"}else{return"right-side"}};ContactItem.prototype.bump=function(){this.bumped=true;return $timeout(function(_this){return function(){return _this.unBump()}}(this),5*6e4)};ContactItem.prototype.unBump=function(){return this.bumped=false};return ContactItem}()}]);
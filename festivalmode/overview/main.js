var FM_OverviewArticleView,FM_OverviewView,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;FM_OverviewArticleView=function(superClass){extend(FM_OverviewArticleView,superClass);function FM_OverviewArticleView(){return FM_OverviewArticleView.__super__.constructor.apply(this,arguments)}FM_OverviewArticleView.prototype.init=function($el,collectionView){this.$el=$el;return this.model={}};FM_OverviewArticleView.prototype.buildNextLink=function(){var $nextSlide;$nextSlide=this.$el.next();if($nextSlide.length){this.model.next_article_title=$nextSlide.find("h2:first").text();this.model.next_article_id=$nextSlide.attr("data-view");return this.buildView("#article-next-link-template")}};FM_OverviewArticleView.prototype.buildIndexLink=function(){this.model.article_id=this.$el.attr("data-view");this.model.article_title=this.$el.find("h2").text();this.model.isNested=this.$el.filter("[data-nested]").length>0;return this.buildView("#article-index-link-template")};return FM_OverviewArticleView}(BaseView);FM_OverviewView=function(superClass){extend(FM_OverviewView,superClass);function FM_OverviewView(){return FM_OverviewView.__super__.constructor.apply(this,arguments)}FM_OverviewView.prototype.events=[["mousedown","#table-of-contents span:not(.active)","loadFrameFromIndex"],["mousedown",'[data-go="back"]',"goBack"],["mousedown",'[data-go="next"]',"goNext"],["mousedown",".article-next-link span","goNext"]];FM_OverviewView.prototype.ui={$tableOfContents:"#table-of-contents",$articleLinks:"#table-of-contents > span",$articleContainer:"#article-container",$slideContainer:".slides",$articles:"article",$backButton:'[data-go="back"]',$nextButton:'[data-go="next"]',$nextLinks:".next-links"};FM_OverviewView.prototype.init=function($el){this.$el=$el;this.bindView();this.currentFrame=0;this.totalFrames=this.ui.$articles.length;this.attachSlideOrientation(this.ui.$articles.eq(0));this.setupLeftRightKeypress();this.initArticleCollection();return this.$el.css("visibility","visible")};FM_OverviewView.prototype.initArticleCollection=function(){this.ui.$articles.each(function(_this){return function(index,article){return _this.initArticle($(article),_this)}}(this));this.setDisabledStates();this.setSlideDimensions();this.resizeTimeout=null;return $(window).resize(function(_this){return function(){return _this.onResize()}}(this))};FM_OverviewView.prototype.onResize=function(){clearTimeout(this.resizeTimeout);return this.resizeTimeout=setTimeout(function(_this){return function(){_this.setSlideDimensions();return _this.transitionFrame(_this.getCurrentFrameElement())}}(this),100)};FM_OverviewView.prototype.setSlideDimensions=function(){this.setSlideWidth();this.articleContainerHeight=this.ui.$articleContainer.outerHeight();return this.ui.$articles.each(function(_this){return function(index,slide){return _this.updateSlideHeightSettings($(slide))}}(this))};FM_OverviewView.prototype.setSlideWidth=function(){var windowWidth;windowWidth=$(window).width();this.ui.$articles.css("width",windowWidth);return this.ui.$nextLinks.children().css("width",windowWidth)};FM_OverviewView.prototype.updateSlideHeightSettings=function($slide){var $inner,$splitDesc;$inner=$slide.find(".article-content > .inner");this.updateHeightSettingFor($inner);$splitDesc=$slide.find(".inner.split .description");return this.updateHeightSettingFor($splitDesc)};FM_OverviewView.prototype.updateHeightSettingFor=function($element){var extraSpace,innerHeight;innerHeight=$element.outerHeight(true);extraSpace=this.getParentAvailableHeight($element)-innerHeight;if(extraSpace>0){return $element.css("margin-top",extraSpace/2)}};FM_OverviewView.prototype.getParentAvailableHeight=function($element){var $parent,paddingBottom,paddingTop;$parent=$element.parent();paddingTop=parseInt($parent.css("padding-top"));paddingBottom=parseInt($parent.css("padding-bottom"));return $parent.outerHeight(true)-paddingTop-paddingBottom};FM_OverviewView.prototype.initArticle=function($article){var view;if($article.hasClass("unpublished")){return}view=new FM_OverviewArticleView($article);this.ui.$nextLinks.append(view.buildNextLink());return this.ui.$tableOfContents.append(view.buildIndexLink())};FM_OverviewView.prototype.loadFrameFromIndex=function($trigger){this.currentFrame=$trigger.index();return this.triggerViewChange($trigger)};FM_OverviewView.prototype.goBack=function(){return this.triggerStepNavChange(-1)};FM_OverviewView.prototype.goNext=function(){return this.triggerStepNavChange(1)};FM_OverviewView.prototype.triggerStepNavChange=function(change){var changeFrame,newFrame;newFrame=this.currentFrame+change;changeFrame=newFrame>=0&&newFrame<this.totalFrames;if(changeFrame){return this.loadNewFrame(newFrame)}};FM_OverviewView.prototype.getCurrentFrameElement=function(newFrame){var indexSelector;indexSelector=":eq("+this.currentFrame+")";return this.ui.$articles.filter(indexSelector)};FM_OverviewView.prototype.loadNewFrame=function(newFrame){var $newFrame;this.currentFrame=newFrame;$newFrame=this.getCurrentFrameElement();this.loadView($newFrame.attr("data-view"));return this.transitionFrame($newFrame)};FM_OverviewView.prototype.attachSlideOrientation=function($newFrame){$newFrame.prevAll().attr("data-slide-orientation","before");$newFrame.nextAll().attr("data-slide-orientation","after");return $newFrame.attr("data-slide-orientation","active")};FM_OverviewView.prototype.transitionFrame=function($newFrame){var leftOffset;this.attachSlideOrientation($newFrame);leftOffset=$newFrame.position().left*-1;this.ui.$slideContainer.css("left",leftOffset);return this.ui.$nextLinks.css("left",leftOffset)};FM_OverviewView.prototype.onAfterLoadView=function(newView){this.setDisabledStates();return $("#article-container").scrollTop(0)};FM_OverviewView.prototype.setDisabledStates=function(){var atFirstElement,atLastElement;atFirstElement=this.currentFrame===0;atLastElement=this.currentFrame+1===this.totalFrames;this.ui.$backButton.prop("disabled",atFirstElement);return this.ui.$nextButton.prop("disabled",atLastElement)};FM_OverviewView.prototype.setupLeftRightKeypress=function(){return $("body").on("keydown",function(_this){return function(event){return _this.stepToggle(event,_this.isTabKey(event))}}(this))};FM_OverviewView.prototype.isTabKey=function(event){var isTab;isTab=event.keyCode===9;if(isTab){event.preventDefault()}return isTab};FM_OverviewView.prototype.stepToggle=function(event,isTab){var isBackTab,isFwdTab;isBackTab=isTab&&event.shiftKey;if(event.keyCode===37||isBackTab){return this.goBack()}isFwdTab=isTab&&!event.shiftKey;if(event.keyCode===39||isFwdTab){return this.goNext()}};return FM_OverviewView}(BaseView);(function(){return new FM_OverviewView($("#product-overview"))})();